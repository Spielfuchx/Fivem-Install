#!/bin/bash

echo 'ğŸŒ FiveM txAdmin Linux Installer von SpielFuchx (Ã¼berarbeitet)'

# ğŸ”§ Notwendige Pakete installieren
apt update && apt install -y tar xz-utils wget screen

# ğŸ“ Verzeichnis anlegen
mkdir -p /home/FiveM/server
cd /home/FiveM/server

# ğŸ”½ FiveM-Artefakte herunterladen
echo 'ğŸ“¥ Geben Sie den Link zu den FiveM-Artifakten (.tar.xz) ein:'
read link
wget -O fx.tar.xz "$link"

# ğŸ“¦ Entpacken
echo 'ğŸ“¦ Entpacken der FiveM-Dateien...'
tar xf fx.tar.xz
rm fx.tar.xz
echo 'âœ… Artefakte installiert.'

# â–¶ï¸ run.sh erstellen (Startscript)
cat <<EOF > run.sh
#!/bin/bash
cd \$(dirname \$0)
screen -dmS fivem ./FXServer +exec server.cfg
EOF
chmod +x run.sh

# ğŸ›‘ stop.sh erstellen (Stoppscript)
cat <<EOF > stop.sh
#!/bin/bash
echo "ğŸ›‘ Stoppe FiveM Server..."
screen -S fivem -X quit
EOF
chmod +x stop.sh

# ğŸ•’ Crontab Eintrag fÃ¼r Autostart
(crontab -l 2>/dev/null; echo "@reboot /bin/bash /home/FiveM/server/run.sh > /home/FiveM/server/cron.log 2>&1") | crontab -

# â–¶ï¸ Server direkt starten
./run.sh

echo 'âœ… Installation abgeschlossen!'
echo ''
echo 'â¡ï¸ Zum Starten:      ./run.sh'
echo 'â›” Zum Stoppen:      ./stop.sh'
echo 'ğŸ”„ Autostart ist via Crontab aktiviert.'
